<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    td, th { border: 1px solid #ccc; padding: 6px; }
    button { padding: 6px 10px; margin: 4px; cursor: pointer; }
  </style>
</head>
<body>

<h2>Panel de Productos - <?= negocio_id ?></h2>

<div id="productos"></div>

<script>
  const negocio = "<?= negocio_id ?>";

  google.script.run
    .withSuccessHandler(render)
    .getProductos(negocio);

  function render(data) {
    let html = "<table>";
    html += "<tr>";

    data[0].forEach(h => html += "<th>" + h + "</th>");
    html += "<th> Acciones </th></tr>";

    for (let i = 1; i < data.length; i++) {
      html += "<tr>";
      data[i].forEach(col => html += "<td contenteditable>" + col + "</td>");
      html += `<td><button onclick="guardar(${i+1})">Guardar</button></td>`;
      html += "</tr>";
    }

    html += "</table>";
    document.getElementById("productos").innerHTML = html;
  }

  function guardar(fila) {
    const tds = event.target.parentNode.parentNode.querySelectorAll("td");
    const valores = [];

    for (let i = 0; i < tds.length - 1; i++) {
      valores.push(tds[i].innerText);
    }

    google.script.run.guardarProducto(negocio, fila, valores);
    alert("Guardado");
  }
</script>

</body>
</html>
